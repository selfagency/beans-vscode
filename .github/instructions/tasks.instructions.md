---
title: Beans Task Management Rules
description: Generated Copilot instructions for Beans workflows in this workspace.
---

# Beans Task Management Rules

<CRITICALLY_IMPORTANT>

1. **Never start work without a bean.** Before writing any code or making any change, find a relevant existing bean or create a new one. Set its status to `in-progress`. There are no exceptions.

2. **Always use the extension or MCP first.** Invoke Beans operations through the VS Code extension commands or MCP tools. Use the `@beans` chat participant for guidance. Fall back to the CLI only when the extension, chat, and MCP are genuinely unavailable — and even then, read the constraints below.

3. **Track all work in the bean's body.** Maintain a `## Todo` checklist in the bean body. After each completed step, mark the item done and sync the bean. Never use TodoWrite, editor scratch pads, or ad-hoc lists.

4. **Commit beans promptly.**
   - Commit a bean immediately after creating or modifying it — unless you are creating a milestone/epic and are about to create its child beans, in which case commit everything together once the hierarchy is complete.
   - Completed todo items may be committed together with the code changes they relate to.

5. **Start or resume on the correct issue branch before writing code.**
   - If the issue does not already have a branch, create one when you begin work.
   - If you are resuming work, checkout the existing branch for that issue first.
   - Branch names must follow: `[type]/[issue-number-without-prefix]-[short-title]`.
   - Examples: `feat/1234-add-search`, `fix/987-crash-on-init`.
   - Push the branch and record it in the bean frontmatter as soon as it exists.

6. **Record the branch and PR in the bean.** As soon as a branch or PR exists, add it to the bean's YAML frontmatter:

   ```yaml
   branch: feature/<bean-id>-<slug>
   pr: <pr-number>
   ```

   Commit this update immediately.

7. **Closing a bean.**
   - Completed: add a `## Summary of Changes` section, then set status to `completed`.
   - Scrapped: add a `## Reasons for Scrapping` section, then set status to `scrapped`.

</CRITICALLY_IMPORTANT>

<!-- Agent-specific constraints: enforce by Copilot/skills -->

1. **Agent MUST create or switch to the issue branch before making any edits.**
   - If the bean already has an existing branch, checkout that branch; otherwise create a new branch and push it immediately.
   - Branch names must follow the repository convention and be recorded in the bean frontmatter as shown above.

2. **Agents must NOT keep a separate internal todo list.**
   - All progress, subtasks and checkboxes belong in the bean's `## Todo` checklist in the bean body.
   - The agent must update the bean's `## Todo` via the MCP or extension APIs and commit the updated bean; never persist task state only in the agent runtime.

3. **Agents must NOT create bean files by writing files directly or adding custom frontmatter fields.**
   - Always use the MCP or extension commands to create or edit beans. Do not write new `.md` bean files directly in the repository.
   - The only permitted bean frontmatter keys the agent may set are `branch` and `pr` (PR number). Do not add custom fields beyond these.

## Beans Usage Guide for Agents (Extension-First)

This file is generated by the Beans VS Code extension and defines the preferred execution model.

## Interface priority (highest → lowest)

**Always try each level in order. Only descend when the level above is genuinely unavailable.**

1. **Beans VS Code extension commands/UI** ← start here every time
2. **Beans chat participant (`@beans`) and slash commands**
3. **Beans MCP tools**
4. **Beans CLI** ← last resort only; see constraints below

The CLI is a fallback for environments where the extension, chat participant, and MCP are all inaccessible. Do not prefer it for convenience.

## Generated artifact context

When AI features are enabled, the extension maintains:

- `.github/instructions/tasks.instructions.md`
- `.github/skills/beans/SKILL.md`

Use these as authoritative guidance for Beans workflows in this repository.

## Core Beans workflow

1. **Before any work:** search for a relevant bean using `beans.search` or `@beans /search`. If none fits, create one with `beans.create` and set it to `in-progress`.
2. **Create or checkout the issue branch** before coding.
   - If starting new issue work, create a branch using `[type]/[issue-number-without-prefix]-[short-title]`.
   - If resuming, checkout the issue's existing branch.
   - Examples: `feat/1234-add-search`, `fix/987-crash-on-init`.
3. **Push branch and add branch/PR to bean frontmatter** as soon as they exist. Commit the bean update.
4. **Maintain a `## Todo` checklist** in the bean body. Update it after every completed step and commit the updated bean (alone or together with related code changes).
5. **On completion**, add `## Summary of Changes`, set status to `completed`, and commit the final bean state.
6. **On scrap**, add `## Reasons for Scrapping`, set status to `scrapped`, and commit.

## Extension commands (preferred)

**Bean operations:**

- `beans.create`, `beans.view`, `beans.edit`, `beans.delete` (draft/scrapped only)
- `beans.setStatus`, `beans.setType`, `beans.setPriority`
- `beans.setParent`, `beans.removeParent`, `beans.editBlocking`
- `beans.reopenCompleted`, `beans.reopenScrapped`
- `beans.copyId`

**Search and navigation:**

- `beans.search`, `beans.filter`, `beans.sort`, `beans.refresh`
- `beans.searchView.filter` (filter search results), `beans.searchView.clear` (clear search)
- `beans.details.back` (navigate back in Details view history)

**AI and workflow:**

- `beans.copilotStartWork` — open Copilot Chat with a workflow template (assess status, remaining steps, close/commit, export to GitHub issue, set in-progress, flesh out specs)

**Configuration and help:**

- `beans.init`, `beans.openConfig`, `beans.openExtensionSettings`
- `beans.showOutput`, `beans.openUserGuide`, `beans.openAiFeaturesGuide`
- `beans.openFirstMalformedBean` (navigate to malformed bean files)

## Chat workflows (`@beans`)

- `/summary` — status overview
- `/priority` — top-priority active issues
- `/stale` — stale issues by age
- `/create` — issue creation guidance
- `/next` — suggest the next bean to start
- `/search` — issue search
- `/commit` — issue-related commit guidance

## MCP workflow

1. **Read/context first**: `beans_vscode_llm_context`, view, search, filter, sort.
2. **Mutate only with explicit intent**: create, edit, set status/type/priority, manage relationships.
3. **Destructive actions** (delete, archive) require explicit user confirmation unless the user already requested it.
4. MCP is the preferred programmatic interface when the extension UI is not in focus.

## Planning mode for epic decomposition

When planning an epic:

1. Confirm goal, constraints, and definition of done.
2. Propose a child-issue map grouped by outcomes.
3. For each child issue, include title, type, priority, and dependencies.
4. Ask for approval before creating any issues.
5. Create all approved child issues and link them with parent relationships.
6. **Commit the parent epic and all child beans together** once the hierarchy is complete.
7. Return created IDs and suggest the first issue to start.

Use compact planning checklist format:

- [ ] `<title>` — type=`<type>`, priority=`<priority>`, depends_on=`<ids|none>`

## CLI fallback (only when extension, chat, and MCP are all unavailable)

**Constraints when using the CLI:**

- Always use `--json` for output; never parse plain-text output.
- Never pass large blocks of body text directly as a shell argument; use GraphQL variables or pipe the query into `beans graphql`.
- Run one operation at a time; do not chain destructive commands.

**Allowed CLI command:**

- `beans graphql --json "<query>" [--variables <json>]` (strictly use the GraphQL API for all data operations)
- `beans archive <id>` (only when explicitly requested by the user)

## Beans GraphQL baseline

The following baseline is derived from `beans graphql --schema` and provides comprehensive guidance for working with beans in this project.

"""
A bean represents an issue/task in the beans tracker
"""
type Bean {
  """
  Unique identifier (NanoID)
  """
  id: ID!
  """
  Human-readable slug from filename
  """
  slug: String
  """
  Relative path from .beans/ directory
  """
  path: String!
  """
  Bean title
  """
  title: String!
  """
  Current status (draft, todo, in-progress, completed, scrapped)
  """
  status: String!
  """
  Bean type (milestone, epic, bug, feature, task)
  """
  type: String!
  """
  Priority level (critical, high, normal, low, deferred)
  """
  priority: String!
  """
  Tags for categorization
  """
  tags: [String!]!
  """
  Creation timestamp
  """
  createdAt: Time!
  """
  Last update timestamp
  """
  updatedAt: Time!
  """
  Markdown body content
  """
  body: String!
  """
  Content hash for optimistic concurrency control
  """
  etag: String!
  """
  Parent bean ID (optional, type-restricted)
  """
  parentId: String
  """
  IDs of beans this bean is blocking
  """
  blockingIds: [String!]!
  """
  IDs of beans that are blocking this bean (direct field)
  """
  blockedByIds: [String!]!
  """
  Beans that block this one (incoming blocking links)
  """
  blockedBy(filter: BeanFilter): [Bean!]!
  """
  Beans this one is blocking (resolved from blockingIds)
  """
  blocking(filter: BeanFilter): [Bean!]!
  """
  Parent bean (resolved from parentId)
  """
  parent: Bean
  """
  Child beans (beans with this as parent)
  """
  children(filter: BeanFilter): [Bean!]!
}
"""
Filter options for querying beans
"""
input BeanFilter {
  """
  Full-text search across slug, title, and body using Bleve query syntax.
  
  Examples:
  - "login" - exact term match
  - "login~" - fuzzy match (1 edit distance)
  - "login~2" - fuzzy match (2 edit distance)
  - "log*" - wildcard prefix
  - "\"user login\"" - exact phrase
  - "user AND login" - both terms required
  - "user OR login" - either term
  - "slug:auth" - search only slug field
  - "title:login" - search only title field
  - "body:auth" - search only body field
  """
  search: String
  """
  Include only beans with these statuses (OR logic)
  """
  status: [String!]
  """
  Exclude beans with these statuses
  """
  excludeStatus: [String!]
  """
  Include only beans with these types (OR logic)
  """
  type: [String!]
  """
  Exclude beans with these types
  """
  excludeType: [String!]
  """
  Include only beans with these priorities (OR logic)
  """
  priority: [String!]
  """
  Exclude beans with these priorities
  """
  excludePriority: [String!]
  """
  Include only beans with any of these tags (OR logic)
  """
  tags: [String!]
  """
  Exclude beans with any of these tags
  """
  excludeTags: [String!]
  """
  Include only beans with a parent
  """
  hasParent: Boolean
  """
  Include only beans with this specific parent ID
  """
  parentId: String
  """
  Include only beans that are blocking other beans
  """
  hasBlocking: Boolean
  """
  Include only beans that are blocking this specific bean ID
  """
  blockingId: String
  """
  Include only beans that are blocked by others (via incoming blocking links or blocked_by field)
  """
  isBlocked: Boolean
  """
  Include only beans that have explicit blocked-by entries
  """
  hasBlockedBy: Boolean
  """
  Include only beans blocked by this specific bean ID (via blocked_by field)
  """
  blockedById: String
  """
  Exclude beans that have a parent
  """
  noParent: Boolean
  """
  Exclude beans that are blocking other beans
  """
  noBlocking: Boolean
  """
  Exclude beans that have explicit blocked-by entries
  """
  noBlockedBy: Boolean
}
"""
Structured body modifications applied atomically.
Operations are applied in order: all replacements sequentially, then append.
If any operation fails, the entire mutation fails (transactional).
"""
input BodyModification {
  """
  Text replacements applied sequentially in array order.
  Each old text must match exactly once at the time it's applied.
  """
  replace: [ReplaceOperation!]
  """
  Text to append after all replacements.
  Appended with blank line separator.
  """
  append: String
}
"""
Input for creating a new bean
"""
input CreateBeanInput {
  """
  Bean title (required)
  """
  title: String!
  """
  Bean type (defaults to 'task')
  """
  type: String
  """
  Status (defaults to 'todo')
  """
  status: String
  """
  Priority level (defaults to 'normal')
  """
  priority: String
  """
  Tags for categorization
  """
  tags: [String!]
  """
  Markdown body content
  """
  body: String
  """
  Parent bean ID (validated against type hierarchy)
  """
  parent: String
  """
  Bean IDs this bean is blocking
  """
  blocking: [String!]
  """
  Bean IDs that are blocking this bean
  """
  blockedBy: [String!]
  """
  Custom ID prefix (overrides config prefix for this bean)
  """
  prefix: String
}
type Mutation {
  """
  Create a new bean
  """
  createBean(input: CreateBeanInput!): Bean!
  """
  Update an existing bean
  """
  updateBean(id: ID!, input: UpdateBeanInput!): Bean!
  """
  Delete a bean by ID (automatically removes incoming links)
  """
  deleteBean(id: ID!): Boolean!
  """
  Set or clear the parent of a bean (validates type hierarchy)
  """
  setParent(id: ID!, parentId: String, ifMatch: String): Bean!
  """
  Add a bean to the blocking list
  """
  addBlocking(id: ID!, targetId: ID!, ifMatch: String): Bean!
  """
  Remove a bean from the blocking list
  """
  removeBlocking(id: ID!, targetId: ID!, ifMatch: String): Bean!
  """
  Add a bean to the blocked-by list (this bean is blocked by targetId)
  """
  addBlockedBy(id: ID!, targetId: ID!, ifMatch: String): Bean!
  """
  Remove a bean from the blocked-by list
  """
  removeBlockedBy(id: ID!, targetId: ID!, ifMatch: String): Bean!
}
type Query {
  """
  Get a single bean by ID. Accepts either the full ID (e.g., "beans-abc1") or the short ID without prefix (e.g., "abc1").
  """
  bean(id: ID!): Bean
  """
  List beans with optional filtering
  """
  beans(filter: BeanFilter): [Bean!]!
}
"""
A single text replacement operation.
"""
input ReplaceOperation {
  """
  Text to find (must occur exactly once, cannot be empty)
  """
  old: String!
  """
  Replacement text (can be empty to delete the matched text)
  """
  new: String!
}
scalar Time
"""
Input for updating an existing bean
"""
input UpdateBeanInput {
  """
  New title
  """
  title: String
  """
  New status
  """
  status: String
  """
  New type
  """
  type: String
  """
  New priority
  """
  priority: String
  """
  Replace all tags (nil preserves existing, mutually exclusive with addTags/removeTags)
  """
  tags: [String!]
  """
  Add tags to existing list
  """
  addTags: [String!]
  """
  Remove tags from existing list
  """
  removeTags: [String!]
  """
  New body content (full replacement, mutually exclusive with bodyMod)
  """
  body: String
  """
  Structured body modifications (mutually exclusive with body)
  """
  bodyMod: BodyModification
  """
  Set parent bean ID (null/empty to clear, validates type hierarchy)
  """
  parent: String
  """
  Add beans to blocking list (validates cycles and existence)
  """
  addBlocking: [String!]
  """
  Remove beans from blocking list
  """
  removeBlocking: [String!]
  """
  Add beans to blocked-by list (validates cycles and existence)
  """
  addBlockedBy: [String!]
  """
  Remove beans from blocked-by list
  """
  removeBlockedBy: [String!]
  """
  ETag for optimistic concurrency control (optional)
  """
  ifMatch: String
}
