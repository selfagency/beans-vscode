import{_ as a,o as s,c as n,ae as i}from"./chunks/framework.D6oixKf0.js";const u=JSON.parse('{"title":"Architecture","description":"","frontmatter":{"title":"Architecture"},"headers":[],"relativePath":"developers/architecture.md","filePath":"developers/architecture.md"}'),t={name:"developers/architecture.md"};function o(l,e,r,c,p,d){return s(),n("div",null,[...e[0]||(e[0]=[i(`<h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><p>The Beans VS Code extension follows a layered architecture with clear separation of concerns. The extension runs in the workspace extension host to support remote development scenarios and integrates deeply with GitHub Copilot through MCP (Model Context Protocol) and chat participant APIs.</p><h2 id="architecture-principles" tabindex="-1">Architecture Principles <a class="header-anchor" href="#architecture-principles" aria-label="Permalink to &quot;Architecture Principles&quot;">​</a></h2><ol><li><strong>Remote-First Design</strong>: All operations work seamlessly in SSH, WSL, Dev Containers, and Codespaces</li><li><strong>Security-First</strong>: No shell injection, secure process execution, minimal permissions</li><li><strong>AI-Optimized</strong>: MCP server for tool access, chat participant for conversational workflows</li><li><strong>Testability</strong>: Clear module boundaries enable comprehensive unit and integration testing</li><li><strong>Extension Host Compatibility</strong>: Designed to run in workspace extension host (<code>extensionKind: workspace</code>)</li></ol><h2 id="module-boundaries" tabindex="-1">Module Boundaries <a class="header-anchor" href="#module-boundaries" aria-label="Permalink to &quot;Module Boundaries&quot;">​</a></h2><h3 id="core-layers" tabindex="-1">Core Layers <a class="header-anchor" href="#core-layers" aria-label="Permalink to &quot;Core Layers&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                      Extension Entry                        │</span></span>
<span class="line"><span>│                    (src/extension.ts)                       │</span></span>
<span class="line"><span>│  - Activation lifecycle                                     │</span></span>
<span class="line"><span>│  - Service initialization                                   │</span></span>
<span class="line"><span>│  - Command registration orchestration                       │</span></span>
<span class="line"><span>└──────────────────┬──────────────────────────────────────────┘</span></span>
<span class="line"><span>                   │</span></span>
<span class="line"><span>    ┌──────────────┼──────────────┐</span></span>
<span class="line"><span>    │              │              │</span></span>
<span class="line"><span>    ▼              ▼              ▼</span></span>
<span class="line"><span>┌─────────┐  ┌─────────┐  ┌──────────┐</span></span>
<span class="line"><span>│ UI Layer│  │AI Layer │  │Config    │</span></span>
<span class="line"><span>│         │  │         │  │Layer     │</span></span>
<span class="line"><span>└─────────┘  └─────────┘  └──────────┘</span></span>
<span class="line"><span>    │              │              │</span></span>
<span class="line"><span>    └──────────────┼──────────────┘</span></span>
<span class="line"><span>                   │</span></span>
<span class="line"><span>                   ▼</span></span>
<span class="line"><span>         ┌─────────────────┐</span></span>
<span class="line"><span>         │  Service Layer   │</span></span>
<span class="line"><span>         │ (BeansService)   │</span></span>
<span class="line"><span>         └─────────────────┘</span></span>
<span class="line"><span>                   │</span></span>
<span class="line"><span>                   ▼</span></span>
<span class="line"><span>         ┌─────────────────┐</span></span>
<span class="line"><span>         │   Beans CLI      │</span></span>
<span class="line"><span>         │ (External)       │</span></span>
<span class="line"><span>         └─────────────────┘</span></span></code></pre></div><h3 id="module-structure" tabindex="-1">Module Structure <a class="header-anchor" href="#module-structure" aria-label="Permalink to &quot;Module Structure&quot;">​</a></h3><h4 id="_1-extension-entry-src-extension-ts" tabindex="-1">1. <strong>Extension Entry</strong> (<code>src/extension.ts</code>) <a class="header-anchor" href="#_1-extension-entry-src-extension-ts" aria-label="Permalink to &quot;1. **Extension Entry** (\`src/extension.ts\`)&quot;">​</a></h4><ul><li><strong>Responsibility</strong>: Extension lifecycle management, initialization, and cleanup</li><li><strong>Dependencies</strong>: All major subsystems</li><li><strong>Key Functions</strong>: <ul><li><code>activate()</code>: Initialize services, register commands, set up tree views</li><li><code>deactivate()</code>: Cleanup resources</li><li>Prompt handling for uninitialized workspaces</li><li>AI feature toggle management</li></ul></li></ul><h4 id="_2-service-layer-src-beans-service" tabindex="-1">2. <strong>Service Layer</strong> (<code>src/beans/service/</code>) <a class="header-anchor" href="#_2-service-layer-src-beans-service" aria-label="Permalink to &quot;2. **Service Layer** (\`src/beans/service/\`)&quot;">​</a></h4><ul><li><strong>Module</strong>: <code>BeansService</code></li><li><strong>Responsibility</strong>: Type-safe wrapper around Beans CLI operations</li><li><strong>Security Features</strong>: <ul><li>Argument-based process execution (no shell injection)</li><li>Timeout protection</li><li>JSON parsing with error handling</li></ul></li><li><strong>Key Operations</strong>: <ul><li><code>listBeans()</code>: Fetch all beans with optional filtering</li><li><code>getBean()</code>: Get single bean details</li><li><code>createBean()</code>: Create new bean with metadata</li><li><code>updateBean()</code>: Update bean status, type, priority, relationships</li><li><code>deleteBean()</code>: Delete draft/scrapped beans only</li><li><code>initWorkspace()</code>: Initialize <code>.beans.yml</code> in workspace</li></ul></li></ul><h4 id="_3-ui-layer-src-beans-tree-src-beans-details-src-beans-preview" tabindex="-1">3. <strong>UI Layer</strong> (<code>src/beans/tree/</code>, <code>src/beans/details/</code>, <code>src/beans/preview/</code>) <a class="header-anchor" href="#_3-ui-layer-src-beans-tree-src-beans-details-src-beans-preview" aria-label="Permalink to &quot;3. **UI Layer** (\`src/beans/tree/\`, \`src/beans/details/\`, \`src/beans/preview/\`)&quot;">​</a></h4><h5 id="tree-views-src-beans-tree" tabindex="-1">Tree Views (<code>src/beans/tree/</code>) <a class="header-anchor" href="#tree-views-src-beans-tree" aria-label="Permalink to &quot;Tree Views (\`src/beans/tree/\`)&quot;">​</a></h5><ul><li><strong>Providers</strong>: <ul><li><code>ActiveBeansProvider</code>: Beans with status=todo or in-progress</li><li><code>CompletedBeansProvider</code>: Beans with status=completed</li><li><code>DraftBeansProvider</code>: Beans with status=draft</li><li><code>ScrappedBeansProvider</code>: Beans with status=scrapped</li></ul></li><li><strong>Core Components</strong>: <ul><li><code>BeansTreeDataProvider</code>: Base class for tree rendering and hierarchical display</li><li><code>BeanTreeItem</code>: VS Code TreeItem representation of a bean</li><li><code>BeansFilterManager</code>: Centralized filter state management</li><li><code>BeansDragAndDropController</code>: Drag-and-drop for parent relationship management</li></ul></li><li><strong>Features</strong>: <ul><li>Hierarchical tree with parent-child relationships</li><li>Multi-select support for batch operations</li><li>Customizable sorting (status/priority/type/title, updated, created, id)</li><li>Search and tag filtering</li><li>Context menu actions</li></ul></li></ul><h5 id="details-view-src-beans-details" tabindex="-1">Details View (<code>src/beans/details/</code>) <a class="header-anchor" href="#details-view-src-beans-details" aria-label="Permalink to &quot;Details View (\`src/beans/details/\`)&quot;">​</a></h5><ul><li><strong>Module</strong>: <code>BeansDetailsViewProvider</code></li><li><strong>Responsibility</strong>: WebView panel for displaying bean markdown content with metadata</li><li><strong>Features</strong>: <ul><li>Markdown rendering with syntax highlighting</li><li>Action buttons for common operations</li><li>Metadata display (status, type, priority, dates)</li><li>Relationship visualization (parent, children, blocking)</li></ul></li></ul><h5 id="preview-provider-src-beans-preview" tabindex="-1">Preview Provider (<code>src/beans/preview/</code>) <a class="header-anchor" href="#preview-provider-src-beans-preview" aria-label="Permalink to &quot;Preview Provider (\`src/beans/preview/\`)&quot;">​</a></h5><ul><li><strong>Module</strong>: <code>BeansPreviewProvider</code></li><li><strong>Responsibility</strong>: Virtual document provider for bean markdown</li><li><strong>Use Case</strong>: Enable VS Code markdown preview features for bean files</li></ul><h5 id="search-view-src-beans-search" tabindex="-1">Search View (<code>src/beans/search/</code>) <a class="header-anchor" href="#search-view-src-beans-search" aria-label="Permalink to &quot;Search View (\`src/beans/search/\`)&quot;">​</a></h5><ul><li><strong>Module</strong>: <code>BeansSearchViewProvider</code></li><li><strong>Responsibility</strong>: WebView for advanced search and filtering</li><li><strong>Features</strong>: Full-text search, multi-field filtering, saved searches</li></ul><h4 id="_4-ai-layer-src-beans-chat-src-beans-mcp" tabindex="-1">4. <strong>AI Layer</strong> (<code>src/beans/chat/</code>, <code>src/beans/mcp/</code>) <a class="header-anchor" href="#_4-ai-layer-src-beans-chat-src-beans-mcp" aria-label="Permalink to &quot;4. **AI Layer** (\`src/beans/chat/\`, \`src/beans/mcp/\`)&quot;">​</a></h4><h5 id="chat-integration-src-beans-chat" tabindex="-1">Chat Integration (<code>src/beans/chat/</code>) <a class="header-anchor" href="#chat-integration-src-beans-chat" aria-label="Permalink to &quot;Chat Integration (\`src/beans/chat/\`)&quot;">​</a></h5><ul><li><strong>Module</strong>: <code>BeansChatIntegration</code></li><li><strong>Responsibility</strong>: GitHub Copilot chat participant (<code>@beans</code>)</li><li><strong>Slash Commands</strong>: <ul><li><code>/summary</code>: Current status overview</li><li><code>/priority</code>: Top-priority active issues</li><li><code>/stale</code>: Stale issues by age</li><li><code>/create</code>: Issue creation guidance</li><li><code>/search</code>: Find issues by text</li><li><code>/commit</code>: Issue-related commit guidance</li></ul></li><li><strong>Prompt Templates</strong>: Structured prompts in <code>prompts.ts</code></li><li><strong>Tool Access</strong>: Reads bean data via BeansService</li></ul><h5 id="mcp-integration-src-beans-mcp" tabindex="-1">MCP Integration (<code>src/beans/mcp/</code>) <a class="header-anchor" href="#mcp-integration-src-beans-mcp" aria-label="Permalink to &quot;MCP Integration (\`src/beans/mcp/\`)&quot;">​</a></h5><ul><li><strong>Modules</strong>: <ul><li><code>BeansMcpIntegration</code>: VS Code MCP provider registration</li><li><code>BeansMcpServer</code>: Standalone stdio MCP server</li></ul></li><li><strong>Responsibility</strong>: Expose Beans operations as MCP tools for any AI client</li><li><strong>Tools Exposed</strong>: <ul><li>Workspace: <code>init</code>, <code>refresh</code></li><li>Read: <code>view</code>, <code>list</code>, <code>search</code>, <code>filter</code>, <code>sort</code></li><li>Write: <code>create</code>, <code>edit</code>, <code>set_status</code>, <code>set_type</code>, <code>set_priority</code></li><li>Relationships: <code>set_parent</code>, <code>remove_parent</code>, <code>edit_blocking</code></li><li>Utilities: <code>copy_id</code>, <code>delete</code>, <code>open_config</code>, <code>show_output</code></li></ul></li><li><strong>Server Architecture</strong>: <ul><li>Standalone stdio server bundled as <code>dist/beans-mcp-server.js</code></li><li>Dynamically contributed via <code>mcp.mcpServers</code> API</li><li>Uses remote Node.js (<code>process.execPath</code>) for remote compatibility</li></ul></li></ul><h4 id="_5-commands-layer-src-beans-commands" tabindex="-1">5. <strong>Commands Layer</strong> (<code>src/beans/commands/</code>) <a class="header-anchor" href="#_5-commands-layer-src-beans-commands" aria-label="Permalink to &quot;5. **Commands Layer** (\`src/beans/commands/\`)&quot;">​</a></h4><ul><li><strong>Module</strong>: <code>BeansCommands</code></li><li><strong>Responsibility</strong>: Command palette and context menu command registration</li><li><strong>Command Categories</strong>: <ul><li>Workspace: Init, refresh</li><li>Navigation: View, open preview, show in tree</li><li>Creation: Create bean, create child bean</li><li>Editing: Edit bean, set status/type/priority</li><li>Relationships: Set/remove parent, edit blocking</li><li>Utilities: Copy ID, delete, show output</li><li>Filtering: Filter, clear filter, tag filter</li></ul></li><li><strong>Integration</strong>: Delegates to BeansService and triggers UI refreshes</li></ul><h4 id="_6-configuration-layer-src-beans-config" tabindex="-1">6. <strong>Configuration Layer</strong> (<code>src/beans/config/</code>) <a class="header-anchor" href="#_6-configuration-layer-src-beans-config" aria-label="Permalink to &quot;6. **Configuration Layer** (\`src/beans/config/\`)&quot;">​</a></h4><ul><li><strong>Modules</strong>: <ul><li><code>BeansConfigManager</code>: Read/write <code>.beans.yml</code> workspace config</li><li><code>CopilotInstructions</code>: Generate <code>.github/copilot-instructions.md</code></li><li><code>CopilotSkill</code>: Generate <code>.github/skills/beans/SKILL.md</code></li></ul></li><li><strong>Responsibility</strong>: Manage workspace configuration and AI integration files</li><li><strong>Auto-Generation</strong>: When <code>beans.ai.enabled=true</code>, generates skill and instructions</li><li><strong>Auto-Cleanup</strong>: When <code>beans.ai.enabled=false</code>, removes generated files</li></ul><h4 id="_7-model-layer-src-beans-model" tabindex="-1">7. <strong>Model Layer</strong> (<code>src/beans/model/</code>) <a class="header-anchor" href="#_7-model-layer-src-beans-model" aria-label="Permalink to &quot;7. **Model Layer** (\`src/beans/model/\`)&quot;">​</a></h4><ul><li><strong>Files</strong>: <ul><li><code>Bean.ts</code>: Core Bean type interface</li><li><code>config.ts</code>: BeansConfig type for <code>.beans.yml</code></li><li><code>errors.ts</code>: Typed error classes</li></ul></li><li><strong>Types</strong>: <ul><li><code>Bean</code>: id, title, status, type, priority, body, relationships, timestamps</li><li><code>BeanStatus</code>: todo, in-progress, draft, completed, scrapped</li><li><code>BeanType</code>: milestone, epic, feature, task, bug</li><li><code>BeanPriority</code>: critical, high, normal, low, deferred</li></ul></li><li><strong>Error Types</strong>: <ul><li><code>BeansCLINotFoundError</code>: CLI not in PATH</li><li><code>BeansJSONParseError</code>: Invalid JSON from CLI</li><li><code>BeansTimeoutError</code>: CLI operation timeout</li></ul></li></ul><h4 id="_8-logging-layer-src-beans-logging" tabindex="-1">8. <strong>Logging Layer</strong> (<code>src/beans/logging/</code>) <a class="header-anchor" href="#_8-logging-layer-src-beans-logging" aria-label="Permalink to &quot;8. **Logging Layer** (\`src/beans/logging/\`)&quot;">​</a></h4><ul><li><strong>Module</strong>: <code>BeansOutput</code></li><li><strong>Responsibility</strong>: Centralized logging with output channel and file mirroring</li><li><strong>Features</strong>: <ul><li>Log levels: trace, debug, info, warn, error</li><li>File mirroring to <code>.beans/.vscode/beans-output.log</code> for MCP tool access</li><li>Singleton pattern for global access</li></ul></li></ul><h2 id="data-flow" tabindex="-1">Data Flow <a class="header-anchor" href="#data-flow" aria-label="Permalink to &quot;Data Flow&quot;">​</a></h2><h3 id="bean-read-flow" tabindex="-1">Bean Read Flow <a class="header-anchor" href="#bean-read-flow" aria-label="Permalink to &quot;Bean Read Flow&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User Action (Tree View, Command)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansCommands.viewBean()</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansService.getBean(id)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>execAsync([&#39;beans&#39;, &#39;show&#39;, &#39;--json&#39;, id])</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Beans CLI (reads .beans/*.md)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>JSON Response</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansService parses &amp; validates</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Returns Bean object</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansDetailsViewProvider.show(bean)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>WebView renders bean markdown + metadata</span></span></code></pre></div><h3 id="bean-write-flow" tabindex="-1">Bean Write Flow <a class="header-anchor" href="#bean-write-flow" aria-label="Permalink to &quot;Bean Write Flow&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User Action (Command, Context Menu)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansCommands.updateBeanStatus(id, status)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansService.updateBean(id, { status })</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>execAsync([&#39;beans&#39;, &#39;update&#39;, &#39;--json&#39;, id, &#39;-s&#39;, status])</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Beans CLI (writes to .beans/*.md)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>JSON Response</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansService parses &amp; validates</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Fire tree refresh event</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>All tree providers re-fetch data</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Tree views update UI</span></span></code></pre></div><h3 id="mcp-tool-call-flow" tabindex="-1">MCP Tool Call Flow <a class="header-anchor" href="#mcp-tool-call-flow" aria-label="Permalink to &quot;MCP Tool Call Flow&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Copilot Chat or MCP Client</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>MCP Tool Request (e.g., beans_vscode_create)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansMcpServer.handleToolCall()</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansService.createBean(params)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>execAsync([&#39;beans&#39;, &#39;create&#39;, &#39;--json&#39;, ...args])</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Beans CLI (creates .beans/*.md)</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>JSON Response</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansMcpServer formats response</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>MCP Tool Response to AI client</span></span></code></pre></div><h3 id="chat-participant-flow" tabindex="-1">Chat Participant Flow <a class="header-anchor" href="#chat-participant-flow" aria-label="Permalink to &quot;Chat Participant Flow&quot;">​</a></h3><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>User: &quot;@beans /summary&quot;</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansChatIntegration.handleChatRequest()</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Parse slash command</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>BeansService.listBeans({ excludeStatus: [&#39;completed&#39;, &#39;scrapped&#39;] })</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Beans CLI returns active beans JSON</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Format response with bean counts and priorities</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Return ChatResponseStream</span></span>
<span class="line"><span>    │</span></span>
<span class="line"><span>    ▼</span></span>
<span class="line"><span>Copilot displays formatted summary</span></span></code></pre></div><h2 id="design-decisions" tabindex="-1">Design Decisions <a class="header-anchor" href="#design-decisions" aria-label="Permalink to &quot;Design Decisions&quot;">​</a></h2><h3 id="_1-why-separate-tree-providers-per-status" tabindex="-1">1. Why Separate Tree Providers per Status? <a class="header-anchor" href="#_1-why-separate-tree-providers-per-status" aria-label="Permalink to &quot;1. Why Separate Tree Providers per Status?&quot;">​</a></h3><p><strong>Decision</strong>: Four separate tree providers (Active, Completed, Draft, Scrapped) instead of one tree with grouping.</p><p><strong>Rationale</strong>:</p><ul><li>Clear mental model: each pane has single responsibility</li><li>User control: independently expandable/collapsible panes</li><li>Performance: only fetch needed data for visible panes</li><li>VS Code UX: matches native experience (Problems, Test Explorer)</li></ul><p><strong>Trade-off</strong>: More code, but better UX and flexibility.</p><h3 id="_2-why-wrap-beans-cli-instead-of-direct-file-access" tabindex="-1">2. Why Wrap Beans CLI Instead of Direct File Access? <a class="header-anchor" href="#_2-why-wrap-beans-cli-instead-of-direct-file-access" aria-label="Permalink to &quot;2. Why Wrap Beans CLI Instead of Direct File Access?&quot;">​</a></h3><p><strong>Decision</strong>: All operations go through BeansService → Beans CLI, not direct <code>.beans/*.md</code> file manipulation.</p><p><strong>Rationale</strong>:</p><ul><li>Single source of truth: Beans CLI handles file format, locking, validation</li><li>GraphQL access: Beans CLI provides efficient query engine</li><li>Future-proof: CLI changes don&#39;t break extension</li><li>Safety: CLI handles edge cases (conflicts, malformed files)</li></ul><p><strong>Trade-off</strong>: Dependency on external CLI, but gains reliability and maintainability.</p><h3 id="_3-why-both-mcp-server-and-chat-participant" tabindex="-1">3. Why Both MCP Server and Chat Participant? <a class="header-anchor" href="#_3-why-both-mcp-server-and-chat-participant" aria-label="Permalink to &quot;3. Why Both MCP Server and Chat Participant?&quot;">​</a></h3><p><strong>Decision</strong>: Implement both MCP tools and a dedicated chat participant.</p><p><strong>Rationale</strong>:</p><ul><li>MCP tools: Atomic operations for any AI client (Claude Desktop, Cline, etc.)</li><li>Chat participant: Conversational workflows specific to Copilot Chat</li><li>Different use cases: MCP for programmatic access, chat for human interaction</li><li>Complementary: MCP provides primitives, chat provides guided workflows</li></ul><p><strong>Trade-off</strong>: More surface area to maintain, but serves diverse user needs.</p><h3 id="_4-why-workspace-extension-host" tabindex="-1">4. Why Workspace Extension Host? <a class="header-anchor" href="#_4-why-workspace-extension-host" aria-label="Permalink to &quot;4. Why Workspace Extension Host?&quot;">​</a></h3><p><strong>Decision</strong>: Set <code>&quot;extensionKind&quot;: [&quot;workspace&quot;]</code> to run in remote extension host.</p><p><strong>Rationale</strong>:</p><ul><li>Remote compatibility: Extension runs where files and CLI exist</li><li>Security: No local-to-remote tunneling of file operations</li><li>Simplicity: One execution model for local and remote</li><li>Performance: Reduced latency for file operations</li></ul><p><strong>Trade-off</strong>: Can&#39;t run UI-only commands without workspace, but this is the right trade-off for a workspace-centric tool.</p><h3 id="_5-why-drag-and-drop-for-parent-relationships" tabindex="-1">5. Why Drag-and-Drop for Parent Relationships? <a class="header-anchor" href="#_5-why-drag-and-drop-for-parent-relationships" aria-label="Permalink to &quot;5. Why Drag-and-Drop for Parent Relationships?&quot;">​</a></h3><p><strong>Decision</strong>: Implement drag-and-drop controller for setting parent relationships.</p><p><strong>Rationale</strong>:</p><ul><li>Intuitive: Visual representation of hierarchy</li><li>Efficient: No multi-step command palette workflow</li><li>Discovery: Users naturally explore dragging beans</li><li>VS Code native: Leverages TreeView drag-and-drop APIs</li></ul><p><strong>Trade-off</strong>: Additional complexity, but significant UX improvement for common operation.</p><h3 id="_6-why-separate-beansfiltermanager" tabindex="-1">6. Why Separate BeansFilterManager? <a class="header-anchor" href="#_6-why-separate-beansfiltermanager" aria-label="Permalink to &quot;6. Why Separate BeansFilterManager?&quot;">​</a></h3><p><strong>Decision</strong>: Centralized filter state in BeansFilterManager instead of per-provider state.</p><p><strong>Rationale</strong>:</p><ul><li>Consistency: Same filter applies across all tree views</li><li>Simplicity: One source of truth for filter state</li><li>Commands: Easy to expose &quot;clear filter&quot; command</li><li>Future: Enables saved filters, filter history</li></ul><p><strong>Trade-off</strong>: Less flexibility for per-view filtering, but clearer UX.</p><h3 id="_7-why-generate-copilot-skill-file" tabindex="-1">7. Why Generate Copilot Skill File? <a class="header-anchor" href="#_7-why-generate-copilot-skill-file" aria-label="Permalink to &quot;7. Why Generate Copilot Skill File?&quot;">​</a></h3><p><strong>Decision</strong>: Dynamically generate <code>.github/skills/beans/SKILL.md</code> when AI features enabled.</p><p><strong>Rationale</strong>:</p><ul><li>Context injection: Provides Beans-specific guidance to Copilot</li><li>Discoverability: Users see skill file, understand integration</li><li>Maintainability: Extension keeps skill updated with capabilities</li><li>Toggle: Clean removal when AI features disabled</li></ul><p><strong>Trade-off</strong>: Generated files in repo, but gitignore prevents commit noise.</p><h3 id="_8-why-timeout-protection-on-cli-calls" tabindex="-1">8. Why Timeout Protection on CLI Calls? <a class="header-anchor" href="#_8-why-timeout-protection-on-cli-calls" aria-label="Permalink to &quot;8. Why Timeout Protection on CLI Calls?&quot;">​</a></h3><p><strong>Decision</strong>: All CLI operations have 30-second timeout (configurable).</p><p><strong>Rationale</strong>:</p><ul><li>Responsiveness: Don&#39;t hang VS Code on slow operations</li><li>Error handling: Explicit timeout error vs indefinite wait</li><li>Remote scenarios: Network issues shouldn&#39;t freeze UI</li><li>Resource protection: Prevent runaway processes</li></ul><p><strong>Trade-off</strong>: Might timeout legitimately slow operations, but better than hanging.</p><h2 id="testing-strategy" tabindex="-1">Testing Strategy <a class="header-anchor" href="#testing-strategy" aria-label="Permalink to &quot;Testing Strategy&quot;">​</a></h2><h3 id="unit-tests" tabindex="-1">Unit Tests <a class="header-anchor" href="#unit-tests" aria-label="Permalink to &quot;Unit Tests&quot;">​</a></h3><ul><li>Location: <code>src/test/beans/</code></li><li>Coverage: Business logic, formatting utilities, config parsing</li><li>Tools: Vitest, mocked VS Code API</li><li>Examples: <ul><li><code>prompts.test.ts</code>: Chat participant prompt formatting</li><li><code>sorting.test.ts</code>: Bean sorting algorithms</li><li><code>CopilotSkill.test.ts</code>: Skill generation logic</li></ul></li></ul><h3 id="integration-tests" tabindex="-1">Integration Tests <a class="header-anchor" href="#integration-tests" aria-label="Permalink to &quot;Integration Tests&quot;">​</a></h3><ul><li>Location: <code>src/test/integration/</code></li><li>Coverage: Extension activation, command registration, tree population</li><li>Tools: <code>@vscode/test-electron</code>, Vitest</li><li>Examples: <ul><li><code>extension-activation.test.ts</code>: Full activation lifecycle</li><li><code>tree-population.test.ts</code>: Tree provider data flow</li><li><code>mcp-integration.test.ts</code>: MCP server startup</li></ul></li></ul><h3 id="ai-integration-tests" tabindex="-1">AI Integration Tests <a class="header-anchor" href="#ai-integration-tests" aria-label="Permalink to &quot;AI Integration Tests&quot;">​</a></h3><ul><li>Location: <code>src/test/integration/ai/</code></li><li>Coverage: MCP tool definitions, chat participant registration</li><li>Examples: <ul><li><code>mcp-integration.test.ts</code>: MCP provider registration</li><li><code>chat-integration.test.ts</code>: Chat participant lifecycle</li><li><code>prompt-assembly.test.ts</code>: Slash command routing</li></ul></li></ul><h2 id="remote-compatibility" tabindex="-1">Remote Compatibility <a class="header-anchor" href="#remote-compatibility" aria-label="Permalink to &quot;Remote Compatibility&quot;">​</a></h2><h3 id="key-remote-patterns" tabindex="-1">Key Remote Patterns <a class="header-anchor" href="#key-remote-patterns" aria-label="Permalink to &quot;Key Remote Patterns&quot;">​</a></h3><ol><li><strong>Path Resolution</strong>: Always use <code>workspaceFolder.uri.fsPath</code> (remote-aware)</li><li><strong>CLI Execution</strong>: Use <code>beans.cliPath</code> config, default to <code>beans</code> in remote PATH</li><li><strong>Process Spawning</strong>: Use <code>process.execPath</code> for Node.js (resolves to remote Node)</li><li><strong>File Access</strong>: Use <code>vscode.workspace.fs</code> APIs for remote filesystem compatibility</li></ol><h3 id="remote-testing-checklist" tabindex="-1">Remote Testing Checklist <a class="header-anchor" href="#remote-testing-checklist" aria-label="Permalink to &quot;Remote Testing Checklist&quot;">​</a></h3><ul><li>[ ] SSH: Test with remote Linux/macOS machine</li><li>[ ] WSL: Test with Ubuntu on Windows</li><li>[ ] Dev Container: Test with <code>.devcontainer/devcontainer.json</code></li><li>[ ] Codespaces: Test with GitHub Codespaces</li><li>[ ] Verify beans CLI installation in each scenario</li><li>[ ] Verify MCP server starts with remote Node.js</li><li>[ ] Verify tree views populate from remote filesystem</li><li>[ ] Verify commands execute in remote context</li></ul><h2 id="extension-points-for-future-development" tabindex="-1">Extension Points for Future Development <a class="header-anchor" href="#extension-points-for-future-development" aria-label="Permalink to &quot;Extension Points for Future Development&quot;">​</a></h2><h3 id="potential-additions" tabindex="-1">Potential Additions <a class="header-anchor" href="#potential-additions" aria-label="Permalink to &quot;Potential Additions&quot;">​</a></h3><ol><li><strong>Archive View</strong>: Separate tree provider for archived beans</li><li><strong>Timeline View</strong>: Show bean history and changes over time</li><li><strong>Dependency Graph</strong>: Visual representation of blocking relationships</li><li><strong>Bulk Operations</strong>: Multi-select actions for batch status/type/priority changes</li><li><strong>Saved Filters</strong>: Persist user-defined filter configurations</li><li><strong>Bean Templates</strong>: Pre-filled templates for common bean types</li><li><strong>Rich Edit Mode</strong>: In-extension editor for bean markdown body</li><li><strong>Conflict Resolution</strong>: UI for handling merge conflicts in bean files</li><li><strong>Export/Import</strong>: Bulk export/import of beans in various formats</li><li><strong>Metrics Dashboard</strong>: Visualize bean lifecycle metrics (cycle time, throughput)</li></ol><h3 id="architecture-for-extensions" tabindex="-1">Architecture for Extensions <a class="header-anchor" href="#architecture-for-extensions" aria-label="Permalink to &quot;Architecture for Extensions&quot;">​</a></h3><ul><li><strong>New Tree Providers</strong>: Extend <code>BeansTreeDataProvider</code> base class</li><li><strong>New Commands</strong>: Register in <code>BeansCommands</code>, delegate to <code>BeansService</code></li><li><strong>New MCP Tools</strong>: Add to <code>BeansMcpServer</code> tool definitions</li><li><strong>New Chat Commands</strong>: Add to <code>BeansChatIntegration</code> slash command router</li><li><strong>New Views</strong>: Implement <code>vscode.WebviewViewProvider</code> or <code>vscode.TreeDataProvider</code></li></ul><h2 id="performance-considerations" tabindex="-1">Performance Considerations <a class="header-anchor" href="#performance-considerations" aria-label="Permalink to &quot;Performance Considerations&quot;">​</a></h2><h3 id="current-optimizations" tabindex="-1">Current Optimizations <a class="header-anchor" href="#current-optimizations" aria-label="Permalink to &quot;Current Optimizations&quot;">​</a></h3><ol><li><strong>Lazy Loading</strong>: Tree items load children on expand</li><li><strong>Caching</strong>: BeansService doesn&#39;t cache (CLI is fast enough)</li><li><strong>Debouncing</strong>: File watcher debounces rapid changes</li><li><strong>Filtered Queries</strong>: Each tree provider only fetches its status filter</li><li><strong>JSON Parsing</strong>: Single-pass parsing with typed validation</li></ol><h3 id="future-optimizations" tabindex="-1">Future Optimizations <a class="header-anchor" href="#future-optimizations" aria-label="Permalink to &quot;Future Optimizations&quot;">​</a></h3><ol><li><strong>Incremental Updates</strong>: Update tree items instead of full refresh</li><li><strong>Virtual Scrolling</strong>: For workspaces with 1000+ beans</li><li><strong>Background Indexing</strong>: Pre-build search index for faster filtering</li><li><strong>Cached GraphQL</strong>: Cache frequently-used GraphQL query results</li><li><strong>Parallel Fetches</strong>: Fetch multiple tree providers simultaneously</li></ol><h2 id="troubleshooting-guide" tabindex="-1">Troubleshooting Guide <a class="header-anchor" href="#troubleshooting-guide" aria-label="Permalink to &quot;Troubleshooting Guide&quot;">​</a></h2><h3 id="common-issues" tabindex="-1">Common Issues <a class="header-anchor" href="#common-issues" aria-label="Permalink to &quot;Common Issues&quot;">​</a></h3><ol><li><p><strong>&quot;Beans CLI not found&quot;</strong></p><ul><li>Check <code>beans.cliPath</code> setting</li><li>Verify CLI in PATH: <code>which beans</code></li><li>Install beans: <code>brew install hmans/beans/beans</code></li></ul></li><li><p><strong>MCP tools not showing</strong></p><ul><li>Check <code>beans.ai.enabled</code> setting</li><li>Run &quot;Beans: MCP: Refresh Server Definitions&quot;</li><li>Check MCP logs: &quot;Beans: MCP: Open Logs&quot;</li></ul></li><li><p><strong>Tree view not populating</strong></p><ul><li>Check workspace has <code>.beans.yml</code></li><li>Run &quot;Beans: Initialize Beans in Workspace&quot;</li><li>Check output channel: &quot;Beans&quot; for errors</li></ul></li><li><p><strong>Remote extension not activating</strong></p><ul><li>Verify beans CLI on remote machine</li><li>Check remote extension host logs</li><li>Reload window: &quot;Developer: Reload Window&quot;</li></ul></li></ol><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to &quot;References&quot;">​</a></h2><ul><li><a href="https://github.com/hmans/beans" target="_blank" rel="noreferrer">Beans CLI Repository</a></li><li><a href="https://code.visualstudio.com/api" target="_blank" rel="noreferrer">VS Code Extension API</a></li><li><a href="https://modelcontextprotocol.io/" target="_blank" rel="noreferrer">Model Context Protocol Spec</a></li><li><a href="https://code.visualstudio.com/docs/remote/remote-overview" target="_blank" rel="noreferrer">VS Code Remote Development</a></li></ul>`,111)])])}const g=a(t,[["render",o]]);export{u as __pageData,g as default};
